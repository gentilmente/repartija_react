<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Repartija</title>

    <!-- DaisyUI CSS (from CDN) -->
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@3.7.6/dist/full.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body
    class="bg-cover bg-center bg-no-repeat min-h-screen"
    style="background-image: url(./dinner.jpg)"
  >
    <div id="root" class="min-h-screen bg-black bg-opacity-50"></div>
    <!-- React and ReactDOM -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <!-- Babel compiler for JSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>

    <script type="text/babel">
      function ItemsList({ submissions, removeItem }) {
        return (
          <div className="mt-4 space-y-2">
            {submissions.map((item, index) => (
              <ListItem
                key={index}
                item={item}
                index={index}
                removeItem={removeItem}
              />
            ))}
          </div>
        );
      }

      function ListItem({ item, removeItem, index }) {
        return (
          <div className="flex items-center btn btn-sm bg-green-500 bg-opacity-50 text-white border-success">
            <span className="flex-grow">
              {item.name}: ${item.pay}
            </span>
            <button onClick={() => removeItem(index)} className="flex-shrink-0">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                strokeWidth={1.5}
                stroke="currentColor"
                className="w-6 h-6"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
                />
              </svg>
            </button>
          </div>
        );
      }

      function CustomForm({
        onSubmit,
        formData,
        setFormData,
        handleChange,
        error,
      }) {
        return (
          <div className="mx-auto">
            <h2 className="text-xl">Submit Your Data</h2>
            <form onSubmit={onSubmit} className="space-y-4 text-slate-800">
              <div className="form-control">
                <input
                  type="text"
                  name="name"
                  value={formData.name}
                  onChange={handleChange}
                  placeholder="Name"
                  className="input input-bordered"
                />
              </div>

              <div className="form-control">
                <input
                  type="number"
                  name="pay"
                  value={formData.pay}
                  onChange={handleChange}
                  placeholder="Pay"
                  className="input input-bordered"
                />
              </div>

              <div className="form-control mt-4">
                <button className="btn btn-primary">Submit</button>
              </div>
              {error && <p className="text-red-500 mt-2">{error}</p>}
            </form>
          </div>
        );
      }

      function App() {
        const defaultFormData = { name: "", pay: "" };
        const mockedSessions = React.useRef([
          {
            id: 1632501234567,
            createdAt: new Date(2023, 8, 25).toISOString(),
            data: [
              { id: 1, name: "John", pay: 200 },
              { id: 2, name: "Doe", pay: 100 },
            ],
          },
          {
            id: 1632587634567,
            createdAt: new Date(2023, 8, 26).toISOString(),
            data: [
              { id: 3, name: "Anna", pay: 50 },
              { id: 4, name: "Smith", pay: 150 },
            ],
          },
        ]);
        const [formData, setFormData] = React.useState(defaultFormData);
        const [submissions, setSubmissions] = React.useState([]);
        const [error, setError] = React.useState(null);
        const [sessions, setSessions] = React.useState([]);
        const [selectedSession, setSelectedSession] = React.useState(null);

        function getSessionsFromLocalStorage() {
          const sessionsJSON = localStorage.getItem("sessions");
          return sessionsJSON
            ? JSON.parse(sessionsJSON)
            : mockedSessions.current;
        }

        function saveSessionsToLocalStorage(sessions) {
          localStorage.setItem("sessions", JSON.stringify(sessions));
        }

        const updateSessionData = (updatedSessionData) => {
          const updatedSessions = sessions.map((session) =>
            session.id === selectedSession.id
              ? { ...session, data: updatedSessionData }
              : session
          );
          saveSessionsToLocalStorage(updatedSessions);
          return updatedSessions;
        };

        React.useEffect(() => {
          // This will run only once when the component is mounted
          const sessionsFromStorage = getSessionsFromLocalStorage();
          setSessions(sessionsFromStorage);

          // If there's a session in storage, select the first one by default
          if (sessionsFromStorage && sessionsFromStorage.length > 0) {
            setSelectedSession(sessionsFromStorage[0]);
            setSubmissions(sessionsFromStorage[0].data);
          }
        }, []);

        // When sessions or submissions change, sync to localStorage
        React.useEffect(() => {
          if (selectedSession) {
            const updatedSessions = updateSessionData(submissions);
            setSessions(updatedSessions);
          }
        }, [submissions, selectedSession]);

        const handleChange = (e) => {
          const { name, value } = e.target;
          setFormData((prevData) => ({ ...prevData, [name]: value }));
        };

        const handleSubmit = (e) => {
          e.preventDefault();

          if (formData.name.trim() === "") {
            setError("Name field is required");
            return;
          }

          const newSubmission = { id: Date.now(), ...formData };
          setSubmissions((prevSubmissions) => [
            ...prevSubmissions,
            newSubmission,
          ]);
          setFormData(defaultFormData);
          setError(null);
        };

        const createSession = () => {
          const newSession = {
            id: Date.now(),
            createdAt: new Date(),
            data: [],
          };
          setSessions((prevSessions) => [...prevSessions, newSession]);
          setSelectedSession(newSession);
          setSubmissions([]);
        };

        const loadSession = (session) => {
          setSelectedSession(session);
          setSubmissions(session.data);
        };

        const removeItem = (itemId) => {
          const updatedSubmissions = submissions.filter(
            (item) => item.id !== itemId
          );
          setSubmissions(updatedSubmissions);
        };

        const formProps = {
          onSubmit: handleSubmit,
          formData: formData,
          setFormData: setFormData,
          handleChange: handleChange,
          error: error,
        };

        return (
          <div className="flex items-center justify-center text-white ">
            <div className="row">
              <div className="col">
                <button className="btn btn-xs" onClick={createSession}>
                  Create Session
                </button>

                <ul>
                  {sessions.map((session) => (
                    <li key={session.id}>
                      Load Session:
                      <button
                        className="btn btn-xs"
                        onClick={() => loadSession(session)}
                      >
                        {new Date(session.createdAt).toLocaleDateString()}
                      </button>
                    </li>
                  ))}
                </ul>

                {selectedSession && (
                  <div>
                    <h2>
                      Session:{" "}
                      {new Date(selectedSession.createdAt).toLocaleDateString()}
                    </h2>

                    {/* This div represents the mockup and is hidden on mobile and visible on desktop */}
                    <div className="mockup-phone hidden md:inline">
                      <div className="camera"></div>
                      <div className="display">
                        <div className="artboard artboard-demo phone-1">
                          <div className="container p-4">
                            <CustomForm {...formProps} />

                            <ItemsList
                              submissions={submissions}
                              removeItem={removeItem}
                            />
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* This div represents the app content and is visible only on mobile */}
                    <div className="md:hidden container p-4">
                      <CustomForm {...formProps} />
                      <ItemsList
                        submissions={submissions}
                        removeItem={removeItem}
                      />
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      // Render the App component to the DOM
      const container = document.getElementById("root");
      const root = ReactDOM.createRoot(container);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
  </body>
</html>
